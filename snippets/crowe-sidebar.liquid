{{ 'section-sidebar.css' | asset_url | stylesheet_tag }}

<nav class="crowe-sidebar" id="crowe-sidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo">
      <img src="{{ 'southwest-mushrooms-logo.PNG' | asset_url }}" alt="Southwest Mushrooms" class="main-logo">
    </div>
    <h1 class="sidebar-brand">
      <a href="{{ routes.root_url }}" class="sidebar-brand-link">
        <img src="{{ 'crowelogo.png' | asset_url }}" alt="Crowe Logic AI" class="crowe-logo white-logo-filter">
        <span class="brand-text">Crowe Logicâ„¢</span>
      </a>
    </h1>
    <button class="sidebar-toggle" aria-label="Close menu">
      {% render 'icon-close' %}
    </button>
  </div>

  <ul class="sidebar-nav">
    <li class="nav-item">
      <a href="{{ routes.root_url }}" class="nav-link">
        <span class="nav-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="nav-text">Dashboard</span>
      </a>
    </li>
    
    <li class="nav-item">
      <a href="{{ routes.collections_url }}" class="nav-link">
        <span class="nav-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" stroke="currentColor" stroke-width="2"/>
            <polyline points="3.27,6.96 12,12.01 20.73,6.96" stroke="currentColor" stroke-width="2"/>
            <line x1="12" y1="22.08" x2="12" y2="12" stroke="currentColor" stroke-width="2"/>
          </svg>
        </span>
        <span class="nav-text">Products</span>
      </a>
    </li>
    
    <li class="nav-item">
      <a href="/pages/audiobook" class="nav-link">
        <span class="nav-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" stroke="currentColor" stroke-width="2"/>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2" stroke="currentColor" stroke-width="2"/>
            <line x1="12" y1="19" x2="12" y2="23" stroke="currentColor" stroke-width="2"/>
            <line x1="8" y1="23" x2="16" y2="23" stroke="currentColor" stroke-width="2"/>
          </svg>
        </span>
        <span class="nav-text">Audiobook</span>
      </a>
    </li>
    
    <li class="nav-item">
      <a href="https://research-assistant-ce196c.zapier.app" class="nav-link" target="_blank" rel="noopener noreferrer">
        <span class="nav-icon">
          <img src="{{ 'crowelogo.png' | asset_url }}" alt="Crowe Logic AI" class="nav-avatar white-logo-filter">
        </span>
        <span class="nav-text">Crowe Logic AI</span>
        <span class="external-link-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" stroke="currentColor" stroke-width="2"/>
            <polyline points="15,3 21,3 21,9" stroke="currentColor" stroke-width="2"/>
            <line x1="10" y1="14" x2="21" y2="3" stroke="currentColor" stroke-width="2"/>
          </svg>
        </span>
      </a>
    </li>
    
    <li class="nav-item">
      <a href="/pages/about" class="nav-link">
        <span class="nav-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="17" r="1" fill="currentColor"/>
          </svg>
        </span>
        <span class="nav-text">About</span>
      </a>
    </li>
    
    <li class="nav-item">
      <a href="/cart" class="nav-link">
        <span class="nav-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="9" cy="21" r="1" stroke="currentColor" stroke-width="2"/>
            <circle cx="20" cy="21" r="1" stroke="currentColor" stroke-width="2"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" stroke="currentColor" stroke-width="2"/>
          </svg>
        </span>
        <span class="nav-text">Cart</span>
      </a>
    </li>
  </ul>

  <div class="sidebar-footer">
    <!-- Crowe Logic AI Chat Section -->
    <div class="sidebar-chat-section" role="region" aria-label="Crowe Logic AI Chat">
      <div class="chat-header">
        <img src="{{ 'crowelogo.png' | asset_url }}" alt="Crowe Logic AI" class="chat-avatar white-logo-filter">
        <div class="chat-info">
          <h3 class="chat-title">Crowe Logic AI</h3>
          <p class="chat-subtitle">Research Assistant</p>
        </div>
      </div>
      <!-- Zapier Chat Widget -->
      <div class="chat-embed-container">
        <script async type='module' src='https://interfaces.zapier.com/assets/web-components/zapier-interfaces/zapier-interfaces.esm.js'></script>
        <zapier-interfaces-chatbot-embed chatbot-id='cmbhp4x71002fqpzzx1cclqec'></zapier-interfaces-chatbot-embed>
        
        <!-- Fallback iframe if web component fails -->
        <noscript>
          <iframe 
            src="https://research-assistant-ce196c.zapier.app" 
            width="100%" 
            height="300"
            frameborder="0"
            allow="microphone; camera; clipboard-write"
            title="Crowe Logic AI Research Assistant"
            style="border-radius: 12px; background: rgba(255, 255, 255, 0.05);">
          </iframe>
        </noscript>
      </div>
    </div>
  </div>
</nav>

<!-- Mobile Sidebar Toggle -->
<button class="mobile-sidebar-toggle" id="mobile-sidebar-toggle" aria-label="Open navigation menu">
  <span class="hamburger-line"></span>
  <span class="hamburger-line"></span>
  <span class="hamburger-line"></span>
</button>

<!-- Sidebar Overlay for Mobile -->
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('crowe-sidebar');
    const mobileToggle = document.getElementById('mobile-sidebar-toggle');
    const sidebarToggle = document.querySelector('.sidebar-toggle');
    const overlay = document.getElementById('sidebar-overlay');
    
    if (!sidebar || !mobileToggle) return;
    
    // Check if mobile
    function isMobile() {
      return window.innerWidth <= 768;
    }
    
    // Toggle sidebar
    function toggleSidebar() {
      sidebar.classList.toggle('sidebar-open');
      overlay.classList.toggle('overlay-active');
      document.body.classList.toggle('sidebar-is-open');
    }
    
    // Close sidebar
    function closeSidebar() {
      sidebar.classList.remove('sidebar-open');
      overlay.classList.remove('overlay-active');
      document.body.classList.remove('sidebar-is-open');
    }
    
    // Mobile toggle click
    mobileToggle.addEventListener('click', toggleSidebar);
    
    // Desktop close button
    if (sidebarToggle) {
      sidebarToggle.addEventListener('click', closeSidebar);
    }
    
    // Overlay click
    overlay.addEventListener('click', closeSidebar);
    
    // Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeSidebar();
      }
    });
    
    // Handle window resize
    window.addEventListener('resize', function() {
      if (!isMobile()) {
        closeSidebar();
      }
    });
    
    // Initialize mobile state
    if (isMobile()) {
      sidebar.classList.add('mobile-sidebar');
    }
  });
</script>
